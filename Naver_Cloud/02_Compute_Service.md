# 02. Compute 서비스

## Compute 상품

- 기본적인 서버를 생성하고 관리하는 상품
  - 한개의 CPU 1기가 메모리를 가진 마이크로 서버(1년간 무료로 사용, 계정당 1대만 사용 가능)
  - 2vCPU~16vCPU 콤팩트 스탠다드 서버(가장 많이 사용)
  - 메모리를 많이 필요로 하는 데이터베이스와 어플리케이션을 위한 그 이상의 256기가 메모리까지 제공할 수 있는 High Memory 서버까지 제공
  - 메모리는 1기가~32기가 램까지 준비되어 있는 스탠다드 서버가 존재
  - 다른 vm과 간섭되는 것을 원하지 않으면 VDS 상품
  - HPC : 금융회사, 증권사와 같이 대규모 연산이 빠른 시간안에 이루어져야 하는 곳에서 서비스에 대응하기 위해 나옴, CPU 쿨럭이 높고 컴퓨팅 파워가 좋은 서버로 구성

- 요금 구성
  - 서버는 기본적으로 CPU, 메모리, 하드 디스크, 네트워크로 구성
  - CPU와 메모리는 전원을 끄면 요금이 발생하지 않음
  - 네트워크는 outbound에서만 요금 발생
  - 서버 정지 시 컴퓨팅, 네트웍 요금은 발생하지 않음
  - 디스크
    - 기본적으로 네이버 클라우드 플랫폼은 서버를 만들면 50기가 또는 100기가의 하드 제공, 이 영역을 OS 영역 루트영역으로 부름, 기본 스토리지로 표시, 스토리지의 공간을 늘리거나 변경을 할 수 없음
    - 서버를 정지시키더라도 요금이 발생
  - 일반적이지 않은 서버는(High Memory 서버, VDS, GPU 서버) 정지를 시켜도 CPU, 메모리 요금이 발생
- SSD, HDD 디스크 타입 제공
  - 네이버 클라우드 플랫폼에서는 디스크 I/O에 대해서 퍼포먼스를 차별화하여 제공
  - SSD와 HDD(SAS) 타입의 디스크 타입을 제공
  - SSD를 사용하면 최대 아이옵스(IOPS)를 보장
    - 최대 아이옵스는 디스크를 만들면 디스크에 맞춰서 4,000~20,000까지 보장
    - 디스크의 용량에 따라 가변적



## 서버 타입

- Micro
- Compact
  - 일반적으로 사용
- Standard
  - 일반적으로 사용
- High Memory
- CPU Intensive
  - CPU 쿨럭이 높고 고성능 연산이 필요한 경우 사용



### 일반 서버

- 서버 스펙
  - 마이크로 서버
    -  CentOS, Ubuntu
    - 1vCPU, 1G RAM, 50G HDD 
    - 서버 스펙이 고정
  - Compact / Standard
    - CentOS, Ubuntu, Windows
    - 2~16vCPU, 4G~32G RAM
    - 자유롭게 스펙 변경 가능
    - High Memory로는 변경 불가
      - 변경하려면 서버를 이미지를 뜬다음 해당 이미지를 High Memory 스펙으로 서버를 만들어야 함
  - High Memory
    - CentOS, Ubuntu, Windows
    - 8~32vCPU, 64~256G RAM
    - 자유롭게 스펙 변경 가능
    - Compact / Standard / Micro로는 스펙 다운 불가
      - 변경하려면 이미지를 통해서 서버를 배포해야 함
  - VDS
    - CentOS, Ubuntu, Windows
    - 20~32vCPU, 80~232G RAM
    - 디스크는 로컬 디스크를 제공, 1~2TB HDD
    - 스펙 업 / 다운이 안됨
  - CPU Intensive
    - CentOS, Ubuntu, Windows
    - 2~32vCPU, 4~64G RAM
    - 이 안에서 스펙 업 / 다운이 가능



#### Bare Metal Server

- 단독으로 사용할 수 있는 고성능 물리 서버를 클라우드 형태로 제공
- 일반적으로 알고 있는 VM들 혹은 클라우드에서 서버 가상화를  쓰는 것이 아니라 Bare Metal이라고 한다면 클라우드에서 서버 자체를 제공
- 물리 서버에 하이퍼바이저 없이 바로 운영 체제를 설치하여 제공
- 물리 서버 그 자체를 사용자한테 제공하는 방식
  - 때문에 물리 서버 성능 그 자체를 다 사용자가 이용할 수 있음
- 보통 데이터 베이스와 게임 등 고성능 혹은 고집적의 서버 스펙을 요구하거나 혹은 특별한 라이센스의 제약사항 때문에 Bare Metal을 사용
- RAID를 사용자가 직접 구성
  - 서버 구성 시 네이버 클라우드는 RAID1+0과 RAID5를 선택할 수 있게 제공
- CentOS, Ubuntu, Windows 외에 ORACLE Linux도 제공
  - 스펙이 2개는 게임에 최적화해서 만들었고 나머지 3개는 데이터베이스 용도로 만들어짐
  - 20core 서버의 경우 MSSQL
    - MSSQL 스탠다드에서 지원하는 최대 코어 수가 20core
    - 만약 32core에 MSSQL을 할당해 사용하면 전체를 다 사용하지 못하고 20core만 사용
  - 8core 서버인 경우 ORACLE
    - 오라클 스탠다드에 최적화
  - 4core 서버인 경우 MSSQL
    - MSSQL의 최소한의 서버 스펙
- Bare Metal은 사용자가 클라우드를 이용하지만 성능에 대해서 리소스에 대해서 가장 높이 끌어올릴 수 있는 용도로 사용
- 물리 서버의 고성능에 대한 장점과 클라우드의 편의성을 두 가지를 모두 이용 가능
- 다만 클라우드를 이용하더라도 클라우드의 다양한 장점 중 몇가지는 사용 못함
  - 내서버 이미지, 스냡샷, 추가 스토리지의 서버 오퍼레이션은 사용 못함
  - 또한 서버 장애 시 Live Migration과 Cold Migration 같은 클라우드 만의 장애 복구 기술을 이용하지 못함



### GPU 서버

- GPU 서버는 최근 머신러닝과 딥러닝에서 많은 각광을 받음
- 병렬 처리에 최적화된 GPU 서버의 고성능 컴퓨팅 파워를 제공
- 딥러닝이나 머신러닝을 위해한 GPU 서버 팜
  - NVIDA P40 장착
  - NVIDIA GRID나 아니면 기타 GPU Core를 제공하는 기술을 사용하지 않음
  - Pass Through라는 기술을 적용해 GPU를 제공
  - 서버 당 최대 2장의 GPU를 사용할 수 있음
- 특이하게 서버 스펙을 사용자가 정하는 것이 아니라 GPU 카드 갯수를 정하게 되면 서버 스펙이 자동으로 고정
  - GPU 카드 한 장당 CPU는 4vCPU, 메모리는 30GB가 할당
- 제공 OS
  - CentOS, Ubuntu



### 서버 타입별 특성

| 기능                   | Micro | Compact | Standard | High Memory     | VDS        | GPU  |
| ---------------------- | ----- | ------- | -------- | --------------- | ---------- | ---- |
| 스토리지 추가          | 불가  | 가능    | 가능     | 가능            | 가능       | 가능 |
| SSD 스토리지 이용      | 불가  | 가능    | 가능     | 가능            | SSD만 제공 | 가능 |
| AutoScaling 이용       | 불가  | 가능    | 가능     | 불가(개선 예정) | 불가       | 불가 |
| IOPS 성능              | 낮음  | 높음    | 높음     | 높음            | 높음       | 높음 |
| Network Interface 이용 | 불가  | 가능    | 가능     | 가능            | 가능       | 불가 |

- 일반적으로 가장 많은 기능을 제공하고 있는 것은 Compact, Standard
- VDS 특성상 AutoScaling 이용 불가, GPU도 마찬가지



### 국가별 지원 서버 타입

| 서비스                | KR   | SG   | JP   | USW  | DE   | HK   | 비고 |
| --------------------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| Server(Compact / Std) | O    | O    | O    | O    | O    | O    |      |
| Server(High-mem)      | O    | O    | O    | O    | O    | X    |      |
| SSD Server            | O    | O    | O    | O    | O    | X    |      |
| GPU                   | O    | X    | X    | X    | X    | X    |      |
| VDS                   | O    | O    | O    | O    | O    | X    |      |
| Baremetal             | O    | O    | O    | O    | O    | X    |      |

- 한국이 가장 많은 서버 타입을 제공



## 서버 Operation 방법

- 웹 콘솔을 이용한 Operation
  - 가장 손쉽게 가장 편하게 오퍼레이션을 사용하는 방법
  - Ncloud.com 콘솔을 이용하여 다양한 오퍼레이션 진행
  - 서버를 키거나 생성하거나 끄거나 스토리지를 붙이거나 이미지를 생성하는 등 다양한 오퍼레이션을 제공
  - 네이버 클라우드 플랫폼의 경우 웹 콘솔의 Operation 기능은 100%
- CLI Operation
  - 사용자의 데스크톱에서 명령어를 통해 서버의 다양한 기술들을 수행
  - 별도의 CLI 툴을 설치하여 명령 프롬프트에서 명령어를 이용하여 Operation
  - S3의 경우 AWS CLI를 이용하여 Operation
  - 네이버 클라우드 플랫폼의 경우 CLI의 Operation 기능은 60%
- API Operation
  - 파이썬이나 자바를 이용해 어플리케이션을 짜고 만들어진 어플리케이션을 이용해서 네이버 클라우드 플랫폼에 서버를 만들거나 Operation을 할 수 있음
  - 네이버 클라우드 플랫폼에서 제공하는 API를 이용하여 Operation 명령어 개발하여 사용
  - S3의 경우 AWS API를 이용하여 Operation
  - 네이버 클라우드 플랫폼의 경우 CLI의 Operation 기능은 60%



## Lab 1

- 서버 생성 Operation
  - 웹을 통한 test 서버 생성
- 먼저 Console로 들어감
- 대시보드에서 왼쪽 메뉴 중 Products & Services
  - 네이버 클라우드 플랫폼의 다양한 상품이 보임
  - 여기서 Server 선택
- 서버 생성 버튼 클릭
  - 부팅 디스크 크기는 C드라이브와 비슷
  - 이미지 타입
    - OS와 Application, DBMS 중 에서 설치할 이미지 선택
    - OS 이미지 타입은 CentOS 선택
  - 서버 타입은 Standard 선택
  - 밑에서 centos-7.3-64 서버 이미지 이름 선택
  - 서버 설정
    - Zone 선택
    - HDD를 선택하면 max iops가 개런티되지 않음
    - max iops를 보장받고 싶으면 SDD
    - 서버 타입마다 서버 스펙 선택
    - 서버 개수 1
    - 서버 이름 설정
    - Script 선택 없음(OS만 설치되어 있는 서버)
  - 인증키 설정
    - 루트 패스워드 설정
    - 인증키 생성 및 저장 선택
  - 네트워크 접근 설정
    - 네이버 클라우드를 처음 시작하면 기본적으로 default-acg 제공
  - 최종 확인
    - 설정한 스펙 확인
    - 서버 생성
- 네이버 클라우드에서 서버를 생성하면 비공인 IP가 할당
  - 외부에서 이 서버에 관리 목적으로 접근할 수 없음
  - 웹 서비스 혹은 다른 어플리케이션 서비스를 하더라도 기본적으로 외부에서 이 서버에 접근 불가능
  - 관리 목적이라면 포트 포워딩 방식을 사용
  - 공인 IP를 부여해서 서버를 외부에서 접속 가능하도록 만들어야만 서버가 서비를 할 수 있음
    - 로드밸런서를 이용해도 외부에서 접속 가능
- 서버 생성 과정
  - 생성중 -> 부팅중 -> 설정중-> 녹색불이 켜지면서 온라인
  - 설정중으로 넘어가면 50기가의 스토리지가 생성
  - 온라인으로 넘어가면 실제 서버가 부팅이 되었고 정상적으로 서비스 준비 상태로 넘어갔다고 볼 수 있음