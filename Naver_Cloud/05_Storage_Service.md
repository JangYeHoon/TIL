# 05. Storage Service

- NCP Storage 서비스에는 오브젝트 스토리지, NAS, Backup 그리고 데이터 텔레포터가 있음

## Object Storage

- 인터넷상에 원하는 데이터를 저장하고 사용할 수 있도록 구축된 오브젝트 스토리지
  - 파일을 저장하고 읽는 단위가 오브젝트. 즉, 파일 단위로 읽고 씀
  - 객체 기반의 무제한 파일 저장 스토리지
  - 콘솔, RESTful API, SDK 등의 다양한 방법으로 오브젝트들을 관리하고, 저장된 파일은 각 파일마다 고유한 접근 URL이 부여되어 인터넷상에서 여러 사용자가 쉽게 접근 가능
  - 때문에 오브젝트 스토리지를 이용해서 CDN 오리진으로 사용할 수 있고 정적 웹 사이트 호스팅 가능
  - 일반적으로 PC나 노트북에서 사용하는 스토리지는 블록 스토리지
    - 블록 스토리지라고 불리는 이유는 읽고 쓰는 단위가 블록 단위이기 때문
- Object Storage 특징
  - AWS의 S3 Compatibility API 지원
    - 기존의 어플리케이션 혹은 웹 사이트들이 AWS의 S3를 이용하고 있다면 기존의 개발 코드 크게 변경없이 AWS에 있는 S3 엔드 포인트를 NCP의 오브젝트 스토리지 엔드 포인트로 변경하여 바로 이용 가능
  - Data Lifecycle 지원
    - 오브젝트 스토리지에 저장되었다가 일정 시간이 지나면 좀 더 저렴한 아카이브 스토리지로 이동시킬 수 있는 기능
  - Sub Account 와의 연동으로 접근 제어 가능
  - CDN, Transcoder, Image Optimizer, Cloud Haddop, Cloud Log Analytics와 같은 NCP 내 다양한 상품과 통합/연계 지원



## Archive Storage

- 아카이브 스토리즈는 오브젝트 스토리지와 비교하여 좀 더 저렴하고 데이터 백업, 장기적으로 저장하는 데이터를 보관하는 용도로 만들어짐
  - 오브젝트 스토리지 보다는 사용 빈도 수가 적음
  - 데이터 처리 API가 저렴
- 데이터 아카이빙 및 장기 백업에 최적화된 스토리지 서비스
  - Infrequent Data 백업 및 Archiving Data 보관을 주 목적으로 하는 스토리지
  - Object Storage 보다 데이터 저장 비용은 저렴, 데이터 처리 API 비용은 비쌈
- Archive Storage 특징
  - 콘솔, API(swift, s3), CLI, SDK를 이용해 데이터 관리 가능
  - 데이터 최소 보관 기간없이 사용할 수 있음
  - 오브젝트 생명주기 관리
  - Sub Account 연동을 통한 권한 관리 기능 제공



## NAS

- 다수의 서버에서 공유하여 사용할 수 있는 스토리지

  - 최소 500GB에서 10TB까지 구성 가능, 추가는 100GB 단위로 추가 가능
  - NAS 가용량 안에서 생성된 스냅샷 이미지 이용해서 데이터에 대한 복구 기능 제공
    - 스냅샷은 기존의 NAS에 있는 데이터들을 일주일동안 데이터를 스냅샷을 찍어서 백업 기능으로 사용할 수 있게 하는 기능
  - 프로토콜은 NFS(리눅스 서버들끼리 공유) / CIFS(윈도우 서버들끼리 공유) 제공
    - NFS는 접근제어 : 서버에 대한 Host IP로 접근 제어
    - CIFS 접근제어 : 사용자의 ID와 Password를 이용해 접근 제어
  - 서버 사설 IP 이용한 ACL 오픈(NFS인 경우)으로 타 계정 서버에도 마운트하여 사용 가능

- Block Storage vs NAS

  |          | 추가 스토리지                                                | NAS                                                          |
  | :------: | :----------------------------------------------------------- | ------------------------------------------------------------ |
  | **장점** | - 적은 용량 추가 가능(최소 10GB 추가 가능, 최대 2TB까지 가능) | - 서버들간 공유 가능<br />- 동적 볼륨 사이즈 조정 가능<br />- 자동 스냅샷 기능 제공(default는 off)<br />- 이벤트 알림 기능 제공 |
  | **단점** | - 공유 불가능                                                | - 최초 큰 용량 제공(초기 500GB 생성, 100GB 단위 증가)        |



## Data Teleporter

- 대용량 데이터 이전을 위한 효과적인 솔루션
  - 보통 레거시 인프라에 있는 데이터들을 네트워크를 통해서 NCP에 플랫폼에 전송하면 시간이 오래 걸림. 이 작업 시간을 효과적으로 줄일 수 있는게 Data Teleporter
  - 대용량 데이터(최대 100T) 이전을 위한 전용 어플라이언스 대여 서비스
  - 네트워크 비용 절감, 안전하고 빠른 데이터 이관이 가능한 서비스
  - 이관 데이터를 NCP Object Storage / NAS에 Import



## Backup

- 서버 내 파일 및 Preinstall DB에 대한 백업 설정
  - 백업 요청서 작성하여 신청하고 서버에 Agent를 설치하면 끝(ncloud.com > 고객지원/FAQ > 자료 > 백업요청서)
  - 백업수행주기로 8가지 옵션 제공(1회성, 1일 1회 전체백업, 1주 1회 전체 백업, 1주 1회 전백업 & 매일 중분 백업 등)
  - 최대 24주까지 백업 파일 보관 가능
  - 백업 파일은 소상을 통해서 안전하게 보관



## Lab 4

- Object Storage & Archive Storage 생성
- Lifecycle Management 생성
- NAS 생성



### Object Storage 생성

- Storage 카테고리 - Object Storage
- 오브젝트 스토리지는 단순히 웹 폴더, 데이터를 넣고 빼는 것 뿐만 아니라 API, SDK, third party를 이용해서 오브젝트 스토리지의 데이터를 읽고 쓸 수 있음
- 오브젝트 스토리지의 저장 단위는 버킷
- 버킷 생성
  - 기본 정보
    - 버킷 이름 설정
  - 권환 관리
    - 공개를 할지 말지 결정
    - Sub Account 권한에 대해서 어떻게 어떤 권한을 줄지 선택
  - 버킷 생성 완료
- 데이터를 읽고 쓰는 것은 웹 뿐만 아니라 thir party tool, API, SDK를 이용해서도 가능



### Lifecycle Management 생성

- 오브젝트 스토리지에서 일정 기간이 지난 데이터들을 좀 더 저렴하고 빈도 수가 낮으니까 안정적인 Archive Storage로 옮김
  - 다만 아카이브 스토리지는 오브젝트 스토리지에 비해서 속도가 느림
- Lifecycle Management를 이용하려면 먼저 Archive Storage에 버킷을 생성해야 함
- 인터페이스는 오브젝트 스토리지와 유사
- 아카이브 스토리지 선택하여 들어감
  - 컨테이너(버킷) 생성 버튼 클릭
    - 이름 설정
- 오브젝트 스토리지 - Lifecycle Management 클릭
  - 30일이 지나면 생성한 아카이브 스토리지로 옮기도록 설정
  - 수명주기 정책 추가 버튼 클릭
    - 대상 버킷 : 오브젝트 스토리지
    - 오브젝트 이름 규칙(접두어) : 접두어를 둬서 필터를 만들 수도 있음
  - 이동 위치 : 생성한 아카이브 스토리지
  - 이관 정책
    - 이관 후 원본 데이터 삭제를 할지 말지 선택 가능
    - 30일이라고 설정
  - 생성



### NAS 생성

- Storage 카테고리 - NAS
- NAS 볼륨 생성 클릭
  - 볼륨 생성
    - Zone 선택 : 어떤 존에 나스를 생성할지 선택
    - NAS 볼륨 이름 설정(예제에서는 labnas001)
    - 볼륨 용량 설정 
    - 프로토콜 설정
      - NFS냐 CIFS냐에 따라 접근 방식에 차이가 있음
    - 봄륨 암호화
  - NFS / CIFS 접근 제어 설정
    - NFS는 서버의 IP, 서버들로 접근 제어
    - 전체 서버 중 접근 권한을 줄 서버 선택
    - CIFS는 ID와 Password로 접근
  - 생성
- NAS 볼륨 마운트 정보가 생김
  - 이 부분을 실제 서버에서 마운트할 때 NFS 마운트 옵션(마운트에 -t 옵션)을 줘서 NFS를 줄거고 그 이후에 마운트 소스가 마운트 정보를 이용해 마운트
- 추가적으로 스냅샷 설정
  - 디폴트는 스냅샷을 생성하지 않음
  - 스냅샷 생성을 수행합니다. 선택
    - 만약 20%를 선택하면 500GB의 볼륨 중 100GB가 스냅샷 공간으로 할당
    - 스냅샷 자동 생성 주기 설정
  - Snapshot 메뉴
    - 여기서 찍혀있는 스냅샷들의 데이터 내용 확인 가능
    - 복구 가능
- 마지막으로 동적으로 데이터 공간 늘리고 줄이기
  - 볼륨 설정 클릭
    - 기존에 설정된 크기보다 더 늘어난 크기로 설정(100GB단위, 예제는 500GB->600GB로 설정)
    - 기존에 설정된 크게보다 더 줄어든 크기로 설정(예제는 600GB->500GB)
      - 데이터가 만약에 500GB가 넘게 데이터가 있으면 줄일 수 있음
      - 가용량이 설정한 용량보다 적어야 크기를 줄일 수 있음
  -  600GB 설정하면 볼륨 할당 용량 480GB, 스냅샷 할당 용량 120GB

